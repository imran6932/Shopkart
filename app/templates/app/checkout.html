{% extends 'app/base.html' %}
{% load static %}
{% block title %}Check Out{% endblock title %}
{% block main-content %}
<div class="container">
 <div class="row mt-5">
  <div class="col-sm-6 offset-sm-1">
      <div class="card mb-2">
        <div class="card-body">
          <h4 class="text-primary">Order Summary</h4>
          <hr>
          {% for item in cart %}
          <div class="row">
            <div class="col-sm-2 text-center align-self-center"><img src="{{item.product.product_image.url}}" alt="" srcset="" class="img-fluid img-thumbnail shadow-sm" height="100" width="100"> </div>
            <div class="col-sm-10">
              <div>
                <p>{{item.product.title}}</p>
                <div class="my-1">
                 <label for="quantity">Quantity:</label>
                 <a class="minus-cart btn" pid="{{item.product.id}}"><i class="fas fa-minus-square fa-lg"></i></a>
                   <span id="quantity">{{item.quantity}}</span>
                 <a class="plus-cart btn" pid="{{item.product.id}}"><i class="fas fa-plus-square fa-lg"></i></a>
                </div> 
                <div class="d-flex justify-content-between">
                 <a class="btn btn-sm btn-secondary mr-3 remove-cart" pid="{{item.product.id}}">Remove item</a>
                 <p class="mb-0"><span><strong>Rs. <span>&#8377;</span>{{item.product.discount_price|floatformat:"-3g"}}</strong></span></p>
                </div>
               </div>
            </div>
           </div>
           <hr>
           {% endfor %}
          </div>
          </div>
          <div class="card">
            <div class="card-body">
              <p class="fw-bold ">Amount: <strong id="amount"> <span>&#8377;</span>{{amount|floatformat:"-3g"}}</strong></p>
          <p class="fw-bold ">Shipping Charge: <strong id="shipping"> <span>&#8377;</span>{{shipping_charge}}</strong></p>
          <p class="fw-bold ">Total Amount Payable: <strong id="totalamount"> <span>&#8377;</span>{{totalamount|floatformat:"-3g"}}</strong></p>
          <hr>
          <small><strong>Terms and Conditions: </strong><p class="justify"> This document is an electronic record in terms of Information Technology Act, 2000 and rules there under as applicable and the amended provisions pertaining to electronic records in various statutes as amended by the Information Technology Act, 2000. This electronic record is generated by a computer system and does not require any physical or digital signatures.</p></small>
            </div>
          </div>
         </div>
  <div class="col-sm-4 offset-sm-1">
    <div class="card">
      <div class="card-body">
        <h4 class=" mb-3 text-primary">Select Delivery Address</h4>
    <hr>
    <form action="/paymentdone" id="payment-form">
      {% if add %}
      {% for ad in add %}
      <div class="card">
        <div class="card-body">
          <div class="form-check ">
            <input class="form-check-input" required type="radio" name="custid" value="{{ad.id}}" id="custadd{{forloop.counter}}">
            <label class="form-check-label fw-bold mx-2" for="custadd{{forloop.counter}}">
                  <h4>{{ad.name}}</h4>
                <h5>{{ad.locality}}, {{ad.city}},</h5>
                <h5>{{ad.state}}-{{ad.pin}}</h5>
            </label>
          </div>
        </div>
      </div>
        {% endfor %}
        {% else %}
        <h4 class="text-center text-danger">You don't have any address</h4>
        <div class="text-center">
          <span><a class="text-decoration-none" href="{% url 'add_profile' %}">Click here to add address</a></span>
        </div>
        {% endif %}
      </form>
      </div>
    </div>
    <div class="card my-5">
      <div class="card-body">
        <h4 class=" my-3 text-primary">Select Payment Option</h4>
        <hr>
        <div class="my-5">
        <div id="paypal-button-container"></div>
        </div>
      </div>
    </div>
    </div>
  </div>
</div>
{% endblock main-content %}

<!-- Paypal Payment Gateway Script -->
{% block payment-gateway %}

<script
src="https://www.paypal.com/sdk/js?client-id=Afim03qCjQLKwar8qLxBCoTIN_hSohFmN7ZtT2LOleLGI5PFkoq_7wAh3PF8zvqUVWIBUZh_FDplemqB">
</script>
  <script>
    paypal.Buttons({
      createOrder: function(data, actions) {
        // This function sets up the details of the transaction, including the amount and line item details.
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: '{{totalamount}}'
            }
          }]
        });
      },
      onApprove: function(data, actions) {
        // This function captures the funds from the transaction.
        return actions.order.capture().then(function(details) {
          // This function shows a transaction success message to your buyer.
          alert('Transaction completed by ' + details.payer.name.given_name);
          document.getElementById('payment-form').submit();
        });
      }
    }).render('#paypal-button-container');
    //This function displays Smart Payment Buttons on your web page.
  </script>

{% endblock payment-gateway %}